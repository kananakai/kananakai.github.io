---
layout: post
title: cloudhub
date: 2016-06-05
tags: japanise
category: aws
---
#### <span style="color:red"> CDP　ネットワーキング（CloudHUB）  

|用語|説明|  
|:-|:-|
|VPN|インターネット回線上に、暗号化技術を利用して専用の経路を確立する技術|
|Amazon VPC|AWS上に理論的な領域を定義し、仮想ネットワークを作成することができる|
|Virtual Gateway|オンプレミスとのネットワーク接続用ゲートウェイ|
|Customer Gateway|オンプレミスとのネットワークに設置荒れているお客様ルーター|
  
#### 解決したい課題  

- VPN CloudHub は、VPC の有無にかかわらず使用できるシンプルなハブアンドスポークモデルで動作します。この設計は、複数のブランチオフィスと既存のインターネット接続を持つ顧客が、リモートオフィス間でプライマリ接続またはバックアップ接続を実現するために、便利でコストを抑えられる可能性のあるハブアンドスポークモデルを実装したいと考えている場合に適しています。  

- 複数拠点間でのVPN（仮想プライベートネットワーク）接続をフルメッシュ型で構築すると、拠点が増えるに従い各拠点のVPNルーターへの設定も煩雑になり、メンテナンスコストが増大する。この問題を解決するためにスター型でVPNを構築すると、各拠点のVPNルーターはVPNハブに接続するだけでよくなる。しかしVPNハブに障害が起こると、すべてのVPN接続に影響を与えてしまうので、VPNハブの可用性が重要な課題となる。  

#### クラウドでの解決/パターンの説明  

  - 従来のVPNハブは、可用性を高めるためにVPNに利用する通信機器を冗長構成にするなど、高額な初期投資を必要としてきた。またVPN接続の利用量にかかわらず設備維持の固定費がかかってしまい、コスト効率も悪い。クラウドにはVPN機能を提供するものもあり、VPNハブとして利用することもできる。可用性の高いクラウド基盤を従量課金で利用することになるので、可用性が高くコスト効率もよい複数拠点間のVPN接続を容易に構築することができる。 
  
  ![CloudHub-diagram](http://docs.aws.amazon.com/ja_jp/AmazonVPC/latest/UserGuide/images/AWS_VPN_CloudHub-diagram.png)  

  
#### 実装  

 - AWS VPN CloudHub を使用するには、複数のカスタマーゲートウェイを使って仮想プライベートゲートウェイを作成する必要があります。それぞれのゲートウェイに対して同じボーダーゲートウェイプロトコル (BGP) 自律システム番号 (ASN) を使用できます。希望に応じて、それぞれに固有の ASN を使用することもできます。カスタマーゲートウェイは、適切なルート（BGP プレフィックス）をその VPN 接続にアドバタイズします。これらのルーティングアドバタイズメントが受信され、各 BGP ピアに再アドバタイズされることで、サイト間でのデータの送受信か可能になります。各スポークのルートに固有の ASN があるので、サイトの IP 範囲が重なることはありません。各サイトが、標準の VPN 接続を使用しているように、VPC とデータを送受信することもできます。  

- AWS VPN CloudHub を設定するには、AWS マネジメントコンソール を使用して、複数のカスタマーゲートウェイを作成します。このそれぞれに、ゲートウェイの固有のパブリック IP アドレスと ASN があります。次に、各カスタマーゲートウェイから一般的な仮想プライベートゲートウェイへの VPN 接続を作成します。各 VPN 接続が、その特定の BGP ルートをアドバタイズする必要があります。これを行うには、VPN 接続の VPN 設定ファイルでネットワークステートメントを使用します。ネットワークステートメントは、使用するルーターの種類によって少し違いがあります。  

#### 料金

- AWS VPN CloudHub を使用する場合は、通常の Amazon VPC VPN 接続料金を支払います。各 VPN が仮想プライベートゲートウェイに接続されている間は、1 時間ごとに接続料金が発生します。AWS VPN CloudHub を使用してサイト間でデータを送信する場合、サイトから仮想プライベートゲートウェイへのデータ送信にはコストがかかりません。仮想プライベートゲートウェイからエンドポイントに中継されるデータに対しては、標準の AWS データ転送料金のみがかかります。例えば、ロサンゼルスとニューヨークそれぞれにサイトがあり、両方のサイトに、仮想プライベートゲートウェイへの VPN 接続が存在する場合は、VPN 接続ごとに 0.05 USD/時間（合計 0.10 USD/時間）の支払いが発生します。また、ロサンゼルスからニューヨーク（およびその逆）に VPN 接続経由でデータを送信すると、そのデータすべてに対して標準の AWS データ転送料金が発生します。VPN 接続経由で仮想プライベートゲートウェイに送信されるネットワークトラフィックは無料ですが、VPN 接続経由で仮想プライベートゲートウェイからエンドポイントに送信されるネットワークトラフィックには、標準の AWS データ転送料金がかかります。詳細については、[「VPN 接続料金表」](https://aws.amazon.com/jp/vpc/pricing/)を参照してください。  

#### 利点  
  
  - 各拠点はVPCに対してVPN接続できれば、他の拠点に対する設定なしに通信できる。  
  - VPNハブをクラウドという可用性が高く運用効率のよいインフラに乗せることで、VPN全体の信頼性を上げることができる。  
  - VPC上に仮想ルーターの一つであるVyatta(EC2)を立ち上げ、そこからHubとなるVGW(Virtual Private Gateway)に接続することで、VPC間をVPN接続することも可能である。  
  - また同一リージョン内のVPC間通信であればVPC Peering機能を使用することで異なるAWSアカウント間においてもVPC間の通信を実施することが可能であり、より低レイテンシ・低コストでのVPC間通信が可能となる。
  
  
    
 > 参考文献  
 - [ホワイトペーパー Amazon Virtual Private Cloud Connectivity Options](http://media.amazonwebservices.com/AWS_Amazon_VPC_Connectivity_Options.pdf)  
 - [Amazon VPC VPN 接続設定 参考資料](http://www.slideshare.net/AmazonWebServicesJapan/amazon-vpc-vpn)  
 - [CDP:CloudHubパターン](http://aws.clouddesignpattern.org/index.php/CDP:CloudHub%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3)
 
 
 














































